#!/usr/bin/env python3
data0 = [
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 
0xFF, 0xFF, 0xE3, 0x81, 0xF8, 0xE0, 0x7E, 0x3F, 
0x1C, 0x0E, 0x07, 0xC7, 0x03, 0xF1, 0xC0, 0xFC, 
0x7E, 0x38, 0x1C, 0x00, 0xE0, 0x70, 0x38, 0x1C, 
0x0E, 0x07, 0x03, 0x83, 0x81, 0xF8, 0xE0, 0x7E, 
0x38, 0x1F, 0x8F, 0xC7, 0x03, 0x81, 0xF1, 0xC0, 
0xFC, 0x70, 0x3F, 0x1F, 0x8E, 0x07, 0x00, 0x38, 
0x1C, 0x0E, 0x07, 0x03, 0x81, 0xC0, 0xE0, 0x60, 
0x7E, 0x38, 0x1F, 0x8E, 0x07, 0xE3, 0xF1, 0xC0, 
0xE0, 0x7C, 0x30, 0x3F, 0x1C, 0x0F, 0xC7, 0xE3, 
0x81, 0xC0, 0x0E, 0x07, 0x03, 0x81, 0xC0, 0xE0, 
0x70, 0x38, 0x18, 0x1F, 0x8E, 0x07, 0xE3, 0x81, 
0xF8, 0xFC, 0x70, 0x38, 0x1F, 0x0C, 0x0F, 0xC7, 
0x03, 0xF1, 0xF8, 0xE0, 0x70, 0x03, 0x81, 0xC0, 
0xE0, 0x70, 0x38, 0x1C, 0x0E, 0x06, 0x03, 0xE3, 
0x81, 0xF8, 0xE0, 0x7E, 0x3F, 0x1C, 0x0E, 0x07, 
0xE3, 0x81, 0xF1, 0xC0, 0xFC, 0x7E, 0x38, 0x1C, 
0x00, 0xE0, 0x70, 0x38, 0x1C, 0x0E, 0x07, 0x03, 
0x81, 0xC0, 0xF8, 0xE0, 0x7E, 0x38, 0x1F, 0x8F, 
0xC7, 0x03, 0x81, 0xF8, 0xE0, 0x7C, 0x70, 0x3F, 
0x1F, 0x8E, 0x07, 0x00, 0x38, 0x1C, 0x0E, 0x07, 
0x03, 0x81, 0xC0, 0xE0, 0x70, 0x3E, 0x18, 0x1F, 
0x8E, 0x07, 0xE3, 0xF1, 0xC0, 0xE0, 0x7E, 0x38, 
0x1F, 0x0C, 0x0F, 0xC7, 0xE3, 0x81, 0xC0, 0x0E, 
0x07, 0x03, 0x81, 0xC0, 0xE0, 0x70, 0x38, 0x1C, 
0x0F, 0x86, 0x07, 0xE3, 0x81, 0xF8, 0xFC, 0x70, 
0x38, 0x1F, 0x8E, 0x07, 0xC3, 0x03, 0xF1, 0xF8, 
0xE0, 0x70, 0x01, 0x81, 0xC0, 0xE0, 0x70, 0x38, 
0x1C, 0x0E, 0x07, 0x03, 0xE1, 0x80, 0xF8, 0xE0, 
0x7E, 0x3F, 0x1C, 0x0E, 0x07, 0xE3, 0x81, 0xF0, 
0xC0, 0x7C, 0x7E, 0x38, 0x1C, 0x00, 0x60, 0x70, 
0x38, 0x1C, 0x0E, 0x07, 0x03, 0x81, 0xC0, 0xF8, 
0x60, 0x3E, 0x38, 0x1F, 0x8F, 0xC7, 0x03, 0x81, 
0xF8, 0xE0, 0x7C, 0x30, 0x1F, 0x1F, 0x8E, 0x07, 
0x00, 0x18, 0x0C, 0x0E, 0x07, 0x03, 0x81, 0xC0, 
0xE0, 0x70, 0x3F, 0x18, 0x0F, 0x86, 0x07, 0xE3, 
0xF1, 0xC0, 0xE0, 0x7E, 0x38, 0x1F, 0x8E, 0x07, 
0xC3, 0xE3, 0x81, 0xC0, 0x06, 0x03, 0x03, 0x81, 
0xC0, 0xE0, 0x70, 0x38, 0x1C, 0x0F, 0xC7, 0x03, 
0xE1, 0x81, 0xF8, 0xFC, 0x70, 0x38, 0x1F, 0x8E, 
0x07, 0xE3, 0x81, 0xF0, 0xF8, 0xE0, 0x70, 0x01, 
0x80, 0xC0, 0xE0, 0x70, 0x38, 0x1C, 0x0E, 0x07, 
0x03, 0xF1, 0xC0, 0xF8, 0x60, 0x7E, 0x3F, 0x1C, 
0x0E, 0x07, 0xE3, 0x81, 0xF8, 0xE0, 0x7C, 0x3E, 
0x38, 0x1C, 0x00, 0x70, 0x30, 0x18, 0x1C, 0x0E, 
0x07, 0x03, 0x81, 0xC0, 0xFC, 0x70, 0x3E, 0x18, 
0x0F, 0x8F, 0xC7, 0x03, 0x81, 0xF8, 0xE0, 0x7E, 
0x38, 0x1F, 0x0F, 0x86, 0x07, 0x00, 0x1C, 0x0C, 
0x06, 0x07, 0x03, 0x81, 0xC0, 0xE0, 0x70, 0x3F, 
0x1C, 0x0F, 0x86, 0x03, 0xE3, 0xF1, 0xC0, 0xE0, 
0x7E, 0x38, 0x1F, 0x8E, 0x07, 0xC3, 0xE1, 0x81, 
0xC0, 0x07, 0x03, 0x81, 0x80, 0xC0, 0xE0, 0x70, 
0x38, 0x1C, 0x0F, 0xC7, 0x03, 0xF1, 0xC0, 0xF8, 
0x7C, 0x70, 0x38, 0x1F, 0x8E, 0x07, 0xE3, 0x81, 
0xF8, 0xF8, 0x60, 0x30, 0x01, 0xC0, 0xE0, 0x60, 
0x30, 0x38, 0x1C, 0x0E, 0x07, 0x03, 0xF1, 0xC0, 
0xFC, 0x70, 0x3E, 0x1F, 0x1C, 0x0E, 0x07, 0xE3, 
0x81, 0xF8, 0xE0, 0x7E, 0x3E, 0x18, 0x0C, 0x00, 
0x70, 0x38, 0x18, 0x0C, 0x0E, 0x07, 0x03, 0x81, 
0xC0, 0xFC, 0x70, 0x3F, 0x1C, 0x0F, 0x87, 0xC7, 
0x03, 0x81, 0xF8, 0xE0, 0x7E, 0x38, 0x1F, 0x8F, 
0x86, 0x03, 0x00, 0x1C, 0x0E, 0x07, 0x03, 0x01, 
0x81, 0xC0, 0xE0, 0x70, 0x3F, 0x1C, 0x0F, 0xC7, 
0x03, 0xE1, 0xF0, 0xC0, 0xE0, 0x7E, 0x38, 0x1F, 
0x8E, 0x07, 0xE3, 0xF1, 0xC0, 0xC0, 0x07, 0x03, 
0x81, 0xC0, 0xC0, 0x60, 0x70, 0x38, 0x1C, 0x0F, 
0xC7, 0x03, 0xF1, 0xC0, 0xF8, 0x7C, 0x30, 0x38, 
0x1F, 0x8E, 0x07, 0xE3, 0x81, 0xF8, 0xFC, 0x70, 
0x30, 0x01, 0xC0, 0xE0, 0x70, 0x38, 0x18, 0x0C, 
0x0E, 0x07, 0x03, 0xF1, 0xC0, 0xFC, 0x70, 0x3F, 
0x1F, 0x0C, 0x06, 0x07, 0xE3, 0x81, 0xF8, 0xE0, 
0x7E, 0x3F, 0x1C, 0x0E, 0x00, 0x70, 0x38, 0x1C, 
0x0E, 0x06, 0x03, 0x01, 0x81, 0xC0, 0xFC, 0x70, 
0x3F, 0x1C, 0x0F, 0xC7, 0xC3, 0x01, 0x81, 0xF8, 
0xE0, 0x7E, 0x38, 0x1F, 0x8F, 0xC7, 0x03, 0x80, 
0x1C, 0x0E, 0x07, 0x03, 0x81, 0xC0, 0xC0, 0x60, 
0x70, 0x3F, 0x1C, 0x0F, 0xC7, 0x03, 0xF1, 0xF8, 
0xE0, 0x60, 0x3E, 0x38, 0x1F, 0x8E, 0x07, 0xE3, 
0xF1, 0xC0, 0xE0, 0x07, 0x03, 0x81, 0xC0, 0xE0, 
0x70, 0x30, 0x18, 0x1C, 0x0F, 0xC7, 0x03, 0xF1, 
0xC0, 0xFC, 0x7E, 0x38, 0x18, 0x0F, 0x8E, 0x07, 
0xE3, 0x81, 0xF8, 0xFC, 0x70, 0x38, 0x01, 0xC0, 
0xE0, 0x70, 0x38, 0x1C, 0x0C, 0x06, 0x03, 0x03, 
0xF1, 0xC0, 0xFC, 0x70, 0x3F, 0x1F, 0x8E, 0x06, 
0x03, 0xE1, 0x81, 0xF8, 0xE0, 0x7E, 0x3F, 0x1C, 
0x0E, 0x00, 0x70, 0x38, 0x1C, 0x0E, 0x07, 0x03, 
0x01, 0x80, 0xC0, 0xFC, 0x70, 0x3F, 0x1C, 0x0F, 
0xC7, 0xE3, 0x81, 0xC0, 0xF8, 0x60, 0x7E, 0x38, 
0x1F, 0x8F, 0xC7, 0x03, 0x80, 0x1C, 0x0E, 0x07, 
0x03, 0x81, 0xC0, 0xE0, 0x60, 0x30, 0x3F, 0x1C, 
0x01, 0x81, 0xC0, 0xE0, 0x70, 0x38, 0x1F, 0x8E, 
0x07, 0xC3, 0x01, 0xF0, 0xF8, 0xE0, 0x70, 0x3F, 
0x1C, 0x0F, 0xC7, 0x03, 0xE1, 0xF0, 0xC0, 0x60, 
0x03, 0x81, 0xC0, 0xC0, 0x60, 0x30, 0x38, 0x1C, 
0x0E, 0x07, 0xE3, 0x81, 0xF8, 0xE0, 0x7C, 0x3E, 
0x18, 0x1C, 0x0F, 0xC7, 0x03, 0xF1, 0xC0, 0xFC, 
0x7C, 0x30, 0x18, 0x00, 0xE0, 0x70, 0x30, 0x18, 
0x0C, 0x0E, 0x07, 0x03, 0x81, 0xF8, 0xE0, 0x7E, 
0x38, 0x1F, 0x0F, 0x86, 0x07, 0x03, 0xF1, 0xC0, 
0xFC, 0x70, 0x3F, 0x1F, 0x0C, 0x06, 0x00, 0x38, 
0x1C, 0x0C, 0x06, 0x03, 0x01, 0x81, 0xC0, 0xE0, 
0x7E, 0x38, 0x1F, 0x8E, 0x07, 0xC3, 0xE1, 0x81, 
0xC0, 0xFC, 0x70, 0x3F, 0x1C, 0x0F, 0xC7, 0xC3, 
0x01, 0x80, 0x0E, 0x07, 0x03, 0x81, 0x80, 0xC0, 
0x60, 0x70, 0x38, 0x1F, 0x8E, 0x07, 0xE3, 0x81, 
0xF0, 0xF8, 0x60, 0x30, 0x3F, 0x1C, 0x0F, 0xC7, 
0x03, 0xF1, 0xF8, 0xE0, 0x60, 0x03, 0x81, 0xC0, 
0xE0, 0x60, 0x30, 0x18, 0x1C, 0x0E, 0x07, 0xE3, 
0x81, 0xF8, 0xE0, 0x7C, 0x3E, 0x18, 0x0C, 0x0F, 
0xC7, 0x03, 0xF1, 0xC0, 0xFC, 0x7E, 0x38, 0x18, 
0x00, 0xE0, 0x70, 0x38, 0x18, 0x0C, 0x06, 0x03, 
0x03, 0x81, 0xF8, 0xE0, 0x7E, 0x38, 0x1F, 0x8F, 
0x86, 0x03, 0x01, 0xF1, 0xC0, 0xFC, 0x70, 0x3F, 
0x1F, 0x8E, 0x06, 0x00, 0x38, 0x1C, 0x0E, 0x07, 
0x03, 0x01, 0x80, 0xC0, 0xE0, 0x7E, 0x38, 0x1F, 
0x8E, 0x07, 0xE3, 0xE1, 0x80, 0xC0, 0x7C, 0x70, 
0x3F, 0x1C, 0x0F, 0xC7, 0xE3, 0x81, 0xC0, 0x0E, 
0x07, 0x03, 0x81, 0xC0, 0xC0, 0x60, 0x30, 0x18, 
0x1F, 0x8E, 0x07, 0xE3, 0x81, 0xF8, 0xFC, 0x60, 
0x30, 0x1F, 0x0C, 0x0F, 0xC7, 0x03, 0xF1, 0xF8, 
0xE0, 0x70, 0x03, 0x81, 0xC0, 0xE0, 0x70, 0x38, 
0x18, 0x0C, 0x06, 0x07, 0xE3, 0x81, 0xF8, 0xE0, 
0x7E, 0x3F, 0x1C, 0x0C, 0x07, 0xC3, 0x03, 0xF1, 
0xC0, 0xFC, 0x7E, 0x38, 0x1C, 0x00, 0xE0, 0x70, 
0x38, 0x1C, 0x0E, 0x06, 0x03, 0x01, 0x81, 0xF8, 
0xE0, 0x7E, 0x38, 0x1F, 0x8F, 0xC7, 0x03, 0x01, 
0xF0, 0xC0, 0xFC, 0x70, 0x3F, 0x1F, 0x8E, 0x07, 
0x00, 0x38, 0x1C, 0x0E, 0x07, 0x03, 0x81, 0x80, 
0xC0, 0x60, 0x3E, 0x38, 0x1F, 0x8E, 0x07, 0xE3, 
0xF1, 0xC0, 0xC0, 0x7C, 0x30, 0x1F, 0x1C, 0x0F, 
0xC7, 0xE3, 0x81, 0xC0, 0x0E, 0x07, 0x03, 0x81, 
0xC0, 0xE0, 0x70, 0x30, 0x18, 0x0F, 0x8E, 0x07, 
0xE3, 0x81, 0xF8, 0xFC, 0x70, 0x38, 0x1F, 0x0C, 
0x07, 0xC7, 0x03, 0xF1, 0xF8, 0xE0, 0x70, 0x03, 
0x81, 0xC0, 0xE0, 0x70, 0x38, 0x1C, 0x0C, 0x06, 
0x03, 0xE3, 0x81, 0xF8, 0xE0, 0x7E, 0x3F, 0x1C, 
0x0E, 0x07, 0xC3, 0x01, 0xF1, 0xC0, 0xFC, 0x7E, 
0x38, 0x1C, 0x00, 0xE0, 0x70, 0x38, 0x1C, 0x0E, 
0x07, 0x03, 0x01, 0x80, 0xF8, 0x60, 0x7E, 0x38, 
0x1F, 0x8F, 0xC7, 0x03, 0x81, 0xF0, 0xC0, 0x7C, 
0x30, 0x3F, 0x1F, 0x8E, 0x07, 0x00, 0x38, 0x1C, 
0x0E, 0x07, 0x03, 0x81, 0xC0, 0xE0, 0x60, 0x3E, 
0x18, 0x1F, 0x8E, 0x07, 0xE3, 0xF1, 0xC0, 0xE0, 
0x7C, 0x30, 0x1F, 0x0C, 0x0F, 0xC7, 0xE3, 0x81, 
0xC0, 0x0E, 0x07, 0x03, 0x81, 0xC0, 0xE0, 0x70, 
0x38, 0x18, 0x0F, 0x86, 0x07, 0xE3, 0x81, 0xF8, 
0xFC, 0x70, 0x38, 0x1F, 0x0C, 0x07, 0xC3, 0x03, 
0xF1, 0xF8, 0xE0, 0x70, 0x00, 0x00, 0x00, 0x00, 
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
]



# for i, byte in enumerate(data0):
#     print(f"{byte:08b}", end='')
#     if(i % 8 == 0):
#         print('')

raw_bits = ""
for byte in data0:
    raw_bits += f"{byte:08b}"

# print(raw_bits)

phase = 0
h_count = 0
l_count = 0
last_bit = 0
inverted = True
after_reset = False
parsed_bits = []

RS_LIMIT = 300
H0_LIMIT = 2
H1_LIMIT = 5
L0_LIMIT = 6
L1_LIMIT = 3
for bit in raw_bits:
    curr_bit = 1 if(bit == "0" and inverted) else 0

    if(last_bit == curr_bit):
        if(curr_bit == 1):
            h_count += 1
        else:
            l_count += 1
    else: # inversion happened # Reset Logic
        if(l_count >= RS_LIMIT or h_count >= RS_LIMIT):
            after_reset = True
        elif(last_bit == 0):
            if(l_count >= L0_LIMIT):
                parsed_bits.append(0)
            else:
                parsed_bits.append(1)
        else:
            if(h_count >= H1_LIMIT):
                parsed_bits.append(1)
            else:
                parsed_bits.append(0)
        h_count = 1 if(curr_bit == 1) else 0
        l_count = 1 if(curr_bit == 0) else 0

    last_bit = curr_bit

grb_tuples = []
TUP_BITS = 24
for i in range(0, len(parsed_bits), TUP_BITS):
    # Are we at the end? give up
    if(i >= (len(parsed_bits) - TUP_BITS)):
        break
    green = int("".join(str(e) for e in parsed_bits[i:i+8]),2)
    red   = int("".join(str(e) for e in parsed_bits[i+8:i+16]),2)
    blue  = int("".join(str(e) for e in parsed_bits[i+16:i+24]),2)
    grb_tuples.append((green, red, blue))

print(f"orig_len:{len(raw_bits)} bits ({len(raw_bits)/8}bytes")
print(f"len: {len(grb_tuples)}")
print(grb_tuples)
